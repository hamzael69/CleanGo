{% extends 'base.html.twig' %}

{% block title %}Mes demandes de ménage - CleanGo | Historique de vos réservations{% endblock %}


{% block body %}
    <main class="min-h-screen bg-volvic bg-cover bg-center bg-fixed" role="main">
        <div class="min-h-screen bg-gradient-to-b from-black/60 via-black/50 to-black/60">
            <!-- Espace en haut pour repositionner la section plus bas -->
            <div class="h-32"></div>
            
            <div class="container mx-auto px-4 py-8">
                
                <!-- Breadcrumb pour la navigation -->
                {# <nav aria-label="Fil d'Ariane" class="mb-6">
                    <ol class="flex items-center space-x-2 text-white/80 text-sm">
                        <li>
                            <a href="{{ path('app_home') }}" 
                               class="hover:text-teal-200 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-teal-200 focus:ring-offset-2 focus:ring-offset-black/50 rounded px-1">
                                Accueil
                            </a>
                        </li>
                        <li aria-hidden="true" class="text-white/50">→</li>
                        <li aria-current="page" class="text-teal-200 font-medium">Mes demandes</li>
                    </ol>
                </nav> #}

                <section class="max-w-6xl mx-auto bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-8"
                         aria-labelledby="history-title">
                    <header class="text-center mb-8">
                        <h1 id="history-title" class="text-3xl font-bold text-gray-900 mb-4">Mes demandes de ménage</h1>
                        <p class="text-gray-600 max-w-2xl mx-auto">
                            Consultez l'historique et le statut de toutes vos demandes de service de nettoyage.
                        </p>
                        
                        <!-- Action rapide -->
                        <div class="mt-6">
                            <a href="{{ path('cleaning_request_create') }}" 
                               class="inline-flex items-center justify-center bg-[#3AA89E] hover:bg-[#2C8278] text-white px-6 py-3 rounded-lg transition-all duration-300 font-medium focus:outline-none focus:ring-4 focus:ring-[#3AA89E]/30 focus:ring-offset-2 transform hover:-translate-y-0.5 shadow-lg hover:shadow-xl min-h-[44px]"
                               aria-label="Créer une nouvelle demande de nettoyage">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Nouvelle demande
                            </a>
                        </div>
                    </header>
                    
                    <!-- Version desktop/tablet avec amélioration d'accessibilité -->
                    <div class="hidden md:block" role="region" aria-labelledby="table-title">
                        <h2 id="table-title" class="sr-only">Tableau des demandes de ménage</h2>
                        <div class="overflow-hidden rounded-lg border border-gray-200 shadow-sm">
                            <table class="min-w-full bg-white divide-y divide-gray-200" role="table">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Heure début</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Professionnel</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                {% for request in requests %}
                                    <tr class="hover:bg-gray-50 transition-colors duration-200 focus-within:bg-gray-50" tabindex="0">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                            <time datetime="{{ request.date|date('Y-m-d') }}">
                                                {{ request.date|date('d/m/Y') }}
                                            </time>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <time datetime="{{ request.startTime|date('H:i') }}">
                                                {{ request.startTime|date('H:i') }}
                                            </time>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            {% if request.isAccepted %}
                                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"
                                                      role="status" aria-label="Demande acceptée">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                                    </svg>
                                                    Acceptée
                                                </span>
                                            {% else %}
                                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"
                                                      role="status" aria-label="Demande en attente">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                                    </svg>
                                                    En attente
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            {% if request.isAccepted and request.professional %}
                                                <div class="flex items-center">
                                                    <div class="h-8 w-8 bg-[#3AA89E] rounded-full flex items-center justify-center text-white text-sm font-medium mr-3"
                                                         aria-hidden="true">
                                                        {{ request.professional.firstname|first }}{{ request.professional.lastname|first }}
                                                    </div>
                                                    <span class="text-sm font-medium text-gray-900">
                                                        {{ request.professional.firstname }} {{ request.professional.lastname }}
                                                    </span>
                                                </div>
                                            {% else %}
                                                <span class="text-gray-400 text-sm italic">Non assigné</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="px-6 py-16 text-center">
                                            <div class="flex flex-col items-center">
                                                <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6">
                                                    <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                                    </svg>
                                                </div>
                                                <h3 class="text-xl font-medium text-gray-900 mb-3">Aucune demande trouvée</h3>
                                                <p class="text-gray-500 mb-8 max-w-md">
                                                    Vous n'avez pas encore effectué de réservation. 
                                                    Commencez par créer votre première demande de nettoyage.
                                                </p>
                                                <a href="{{ path('cleaning_request_create') }}" 
                                                   class="inline-flex items-center justify-center px-6 py-3 bg-[#3AA89E] hover:bg-[#2C8278] text-white rounded-lg transition-all duration-300 font-medium focus:outline-none focus:ring-4 focus:ring-[#3AA89E]/30 focus:ring-offset-2 transform hover:-translate-y-0.5 shadow-lg hover:shadow-xl min-h-[44px]"
                                                   aria-label="Créer votre première demande de nettoyage">
                                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                                    </svg>
                                                    Faire une première réservation
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Version mobile avec amélioration d'accessibilité -->
                    <div class="md:hidden">
                        <div class="space-y-6" role="region" aria-labelledby="mobile-requests-title">
                            <h2 id="mobile-requests-title" class="sr-only">Liste des demandes de ménage</h2>
                            {% for request in requests %}
                                <article class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow duration-300 focus-within:ring-4 focus-within:ring-[#3AA89E]/20"
                                         tabindex="0"
                                         aria-labelledby="request-{{ loop.index }}-title">
                                    <header class="flex items-start justify-between mb-4">
                                        <div>
                                            <h3 id="request-{{ loop.index }}-title" class="text-lg font-medium text-gray-900">
                                                Demande du <time datetime="{{ request.date|date('Y-m-d') }}">{{ request.date|date('d/m/Y') }}</time>
                                            </h3>
                                            <p class="text-sm text-gray-500">
                                                <time datetime="{{ request.startTime|date('H:i') }}">{{ request.startTime|date('H:i') }}</time>
                                            </p>
                                        </div>
                                        <div>
                                            {% if request.isAccepted %}
                                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"
                                                      role="status" aria-label="Demande acceptée">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                                    </svg>
                                                    Acceptée
                                                </span>
                                            {% else %}
                                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"
                                                      role="status" aria-label="Demande en attente">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                                    </svg>
                                                    En attente
                                                </span>
                                            {% endif %}
                                        </div>
                                    </header>

                                    {% if request.isAccepted and request.professional %}
                                        <div class="border-t border-gray-200 pt-4">
                                            <h4 class="text-sm font-medium text-gray-700 mb-2">Professionnel assigné</h4>
                                            <div class="flex items-center">
                                                <div class="h-8 w-8 bg-[#3AA89E] rounded-full flex items-center justify-center text-white text-sm font-medium mr-3"
                                                     aria-hidden="true">
                                                    {{ request.professional.firstname|first }}{{ request.professional.lastname|first }}
                                                </div>
                                                <span class="text-sm font-medium text-gray-900">
                                                    {{ request.professional.firstname }} {{ request.professional.lastname }}
                                                </span>
                                            </div>
                                        </div>
                                    {% endif %}
                                </article>
                            {% else %}
                                <div class="text-center py-16">
                                    <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6">
                                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                        </svg>
                                    </div>
                                    <h3 class="text-xl font-medium text-gray-900 mb-3">Aucune demande trouvée</h3>
                                    <p class="text-gray-500 mb-8 px-4">
                                        Vous n'avez pas encore effectué de réservation. 
                                        Commencez par créer votre première demande de nettoyage.
                                    </p>
                                    <a href="{{ path('cleaning_request_create') }}" 
                                       class="inline-flex items-center justify-center px-6 py-3 bg-[#3AA89E] hover:bg-[#2C8278] text-white rounded-lg transition-all duration-300 font-medium focus:outline-none focus:ring-4 focus:ring-[#3AA89E]/30 focus:ring-offset-2 transform hover:-translate-y-0.5 shadow-lg hover:shadow-xl min-h-[44px]"
                                       aria-label="Créer votre première demande de nettoyage">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        Faire une première réservation
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Section d'aide et informations pour conformité RGPD -->
                    <aside class="mt-12 bg-gray-50 rounded-xl p-6" aria-labelledby="help-section-title">
                        <h2 id="help-section-title" class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-[#3AA89E]" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Besoin d'aide ?
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-600">
                            <div>
                                <h3 class="font-medium text-gray-900 mb-2">📞 Support client</h3>
                                <p class="mb-2">Notre équipe est à votre disposition :</p>
                                <ul class="space-y-1">
                                    <li>• Du lundi au vendredi : 8h - 19h</li>
                                    <li>• Samedi : 9h - 17h</li>
                                    <li>• 
                                        <a href="tel:+33123456789" 
                                           class="text-[#3AA89E] hover:text-[#2C8278] underline focus:outline-none focus:ring-2 focus:ring-[#3AA89E] focus:ring-offset-1 rounded">
                                            01 23 45 67 89
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h3 class="font-medium text-gray-900 mb-2">🔒 Confidentialité</h3>
                                <p class="mb-2">Vos données personnelles sont protégées selon le RGPD :</p>
                                <ul class="space-y-1">
                                    <li>• 
                                        <a href="#" 
                                           class="text-[#3AA89E] hover:text-[#2C8278] underline focus:outline-none focus:ring-2 focus:ring-[#3AA89E] focus:ring-offset-1 rounded">
                                            Politique de confidentialité
                                        </a>
                                    </li>
                                    <li>• 
                                        <a href="#" 
                                           class="text-[#3AA89E] hover:text-[#2C8278] underline focus:outline-none focus:ring-2 focus:ring-[#3AA89E] focus:ring-offset-1 rounded">
                                            Gérer mes données
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </aside>
                </section>
            </div>
        </div>
    </main>
{% endblock %}